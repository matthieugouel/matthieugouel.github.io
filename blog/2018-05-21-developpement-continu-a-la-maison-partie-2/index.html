<!DOCTYPE HTML>

<html>
    <head>
        
            
                <title>Développement continu à la maison (partie 2)</title>
            
        

        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <meta name="generator" content="Hugo 0.39" />
        
  
    
    
  

  

  <link rel="apple-touch-icon-precomposed" href='/favicon/apple-touch-icon-precomposed-1.0.png'>
  <link rel="icon" href='/favicon/favicon-1.0.png'>
  
  <meta name="msapplication-TileColor" content="#da532c">
  <meta name="msapplication-TileImage" content='/favicon/mstile-1.0.png'>
  <meta name="application-name" content="Random Logs">
  <meta name="msapplication-tooltip" content="A collection of random thoughts (fr).">
  <meta name="msapplication-config" content='/favicon/ieconfig.xml'>



        
        
            <meta name="description" content="Installation du cluster Kubernetes">
        

        <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Développement continu à la maison (partie 2)"/>
<meta name="twitter:description" content="Installation du cluster Kubernetes"/>
<meta name="twitter:site" content="@matthieugouel"/>

        <meta name="twitter:site" content="@matthieugouel">
        <meta name="twitter:creator" content="@matthieugouel">
        
        <meta name="twitter:title" content="Développement continu à la maison (partie 2)" />
        <meta name="twitter:description" content="Installation du cluster Kubernetes" />
        
        <meta name="twitter:card" content="summary_large_image" />
        <meta name="twitter:image" content="https://matthieugouel.github.io/img/main/logo.png" />
        <meta property="og:title" content="Développement continu à la maison (partie 2)" />
<meta property="og:description" content="Installation du cluster Kubernetes" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://matthieugouel.github.io/blog/2018-05-21-developpement-continu-a-la-maison-partie-2/" />



<meta property="article:published_time" content="2018-05-21T00:00:00&#43;00:00"/>

<meta property="article:modified_time" content="2018-05-21T00:00:00&#43;00:00"/>

<meta property="og:site_name" content="Random Logs" />










        <meta property="og:image" content="https://matthieugouel.github.io/img/main/logo.png">
        <meta property="og:image:type" content="image/png">
        <meta property="og:image:width" content="512">
        <meta property="og:image:height" content="256">
        
<meta itemprop="name" content="Développement continu à la maison (partie 2)">
<meta itemprop="description" content="Installation du cluster Kubernetes">


<meta itemprop="datePublished" content="2018-05-21T00:00:00&#43;00:00" />
<meta itemprop="dateModified" content="2018-05-21T00:00:00&#43;00:00" />
<meta itemprop="wordCount" content="1979">



<meta itemprop="keywords" content="Kubernetes," />

        

        
            
        

        
        
            <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/atom-one-light.min.css">
            <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Raleway:400,800,900|Source+Sans+Pro:400,700">
            <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
            <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.1.25/jquery.fancybox.min.css">
            <link rel="stylesheet" href="/css/main.css">
            <link rel="stylesheet" href="/css/add-on.css">
            <link rel="stylesheet" href="/css/academicons.min.css">
        

        
            
                
            
        


  
    
    <link href='//cdn.bootcss.com/highlight.js/9.11.0/styles/github.min.css' rel='stylesheet' type='text/css' />
  


      
    </head>
    <body>

      
      <div id="wrapper">

    
    
<header id="header">
    
      
        <h1><a href="/">Blog</a></h1>
      
    

    <nav class="links">
        <ul>
            
                <li>
                    <a href="/">
                            <i class="fa fa-home">&nbsp;</i>Accueil
                    </a>
                </li>
            
                <li>
                    <a href="/blog/">
                            <i class="fa fa-newspaper-o">&nbsp;</i>Blog
                    </a>
                </li>
            
                <li>
                    <a href="/projects/">
                            <i class="fa fa-tasks">&nbsp;</i>Projets
                    </a>
                </li>
            
                <li>
                    <a href="/categories/">
                            <i class="fa fa-sitemap">&nbsp;</i>Catégories
                    </a>
                </li>
            
                <li>
                    <a href="/contact/">
                            <i class="fa fa-envelope-o">&nbsp;</i>Contact
                    </a>
                </li>
            
        </ul>
    </nav>
    <nav class="main">
        <ul>
            
            <li id="share-nav" class="share-menu" style="display:none;">
                <a class="fa-share-alt" href="#share-menu">Share</a>
            </li>
            
            
            <li class="search">
                <a class="fa-search" href="#search">Search</a>
                <form id="search" method="get" action="//google.com/search">
                    <input type="text" name="q" placeholder="Search" />
                    <input type="hidden" name="as_sitesearch" value="https://matthieugouel.github.io">
                </form>
            </li>
            <li class="menu">
                <a class="fa-bars" href="#menu">Menu</a>
            </li>
        </ul>
    </nav>
</header>


<section id="menu">

    
        <section>
            <form class="search" method="get" action="//google.com/search">
                <input type="text" name="q" placeholder="Search" />
                <input type="hidden" name="as_sitesearch" value="https://matthieugouel.github.io">
            </form>
        </section>

    
        <section>
            <ul class="links">
                
                    <li>
                        <a href="/">
                            <h3>
                                <i class="fa fa-home">&nbsp;</i>Accueil
                            </h3>
                        </a>
                    </li>
                
                    <li>
                        <a href="/blog/">
                            <h3>
                                <i class="fa fa-newspaper-o">&nbsp;</i>Blog
                            </h3>
                        </a>
                    </li>
                
                    <li>
                        <a href="/projects/">
                            <h3>
                                <i class="fa fa-tasks">&nbsp;</i>Projets
                            </h3>
                        </a>
                    </li>
                
                    <li>
                        <a href="/categories/">
                            <h3>
                                <i class="fa fa-sitemap">&nbsp;</i>Catégories
                            </h3>
                        </a>
                    </li>
                
                    <li>
                        <a href="/contact/">
                            <h3>
                                <i class="fa fa-envelope-o">&nbsp;</i>Contact
                            </h3>
                        </a>
                    </li>
                
            </ul>
        </section>

    
        <section id="recent-posts">
            <div class="mini-posts">
                <header>
                    <h3>Posts récents</h3>
                </header>
                

                
                    
                

                
                        <article class="mini-post">
                            <header>
                                <h3><a href="/blog/2018-11-22-oops-i-did-it-again/">Oops!... I Did It Again</a></h3>
                                
                                <time class="published" datetime=
                                    '2018-11-22'>
                                    22-11-2018</time>
                            </header>
                            
    

    
        
        







  


        
        
        

        <a href="/blog/2018-11-22-oops-i-did-it-again/" class="image featured">
            <img src="/img/blog/dev.jpg" alt="">
        </a>
    


                        </article>
                
                        <article class="mini-post">
                            <header>
                                <h3><a href="/blog/2018-07-24-presentation-de-gibica/">Présentation de Gibica</a></h3>
                                
                                <time class="published" datetime=
                                    '2018-07-24'>
                                    24-07-2018</time>
                            </header>
                            
    

    
        
        







  


        
        
        

        <a href="/blog/2018-07-24-presentation-de-gibica/" class="image featured">
            <img src="/img/blog/dev.jpg" alt="">
        </a>
    


                        </article>
                
                        <article class="mini-post">
                            <header>
                                <h3><a href="/blog/2018-06-27-developpement-continu-a-la-maison-partie-4/">Développement continu à la maison (partie 4)</a></h3>
                                
                                <time class="published" datetime=
                                    '2018-06-27'>
                                    27-06-2018</time>
                            </header>
                            
    

    
        
        







  


        
        
        

        <a href="/blog/2018-06-27-developpement-continu-a-la-maison-partie-4/" class="image featured">
            <img src="/img/blog/devops.jpg" alt="">
        </a>
    


                        </article>
                
                        <article class="mini-post">
                            <header>
                                <h3><a href="/blog/2018-06-05-developpement-continu-a-la-maison-partie-3/">Développement continu à la maison (partie 3)</a></h3>
                                
                                <time class="published" datetime=
                                    '2018-06-05'>
                                    05-06-2018</time>
                            </header>
                            
    

    
        
        







  


        
        
        

        <a href="/blog/2018-06-05-developpement-continu-a-la-maison-partie-3/" class="image featured">
            <img src="/img/blog/devops.jpg" alt="">
        </a>
    


                        </article>
                
                        <article class="mini-post">
                            <header>
                                <h3><a href="/blog/2018-05-28-gerer-nos-certificats-ssl/">Gérer nos certificats SSL</a></h3>
                                
                                <time class="published" datetime=
                                    '2018-05-28'>
                                    28-05-2018</time>
                            </header>
                            
    

    
        
        







  


        
        
        

        <a href="/blog/2018-05-28-gerer-nos-certificats-ssl/" class="image featured">
            <img src="/img/blog/devops.jpg" alt="">
        </a>
    


                        </article>
                

                
                    <a href=
                        
                            /blog/
                        
                        class="button">Voir plus</a>
                
            </div>
        </section>

    
        
</section>

    <section id="share-menu">
    <section id="social-share-nav">
        <ul class="links">
            <header>
                <h3>Partager ce post <i class="fa fa-smile-o"></i></h3>
            </header>
            


<li>
  <a href="//twitter.com/share?url=https%3a%2f%2fmatthieugouel.github.io%2fblog%2f2018-05-21-developpement-continu-a-la-maison-partie-2%2f&amp;text=D%c3%a9veloppement%20continu%20%c3%a0%20la%20maison%20%28partie%202%29&amp;via=matthieugouel" target="_blank" class="share-btn twitter">
    <i class="fa fa-twitter"></i>
    <p>Twitter</p>
    </a>
</li>


<li>
  <a href="//plus.google.com/share?url=https%3a%2f%2fmatthieugouel.github.io%2fblog%2f2018-05-21-developpement-continu-a-la-maison-partie-2%2f" target="_blank" class="share-btn google-plus">
    <i class="fa fa-google-plus"></i>
    <p>Google+</p>
  </a>
</li>


<li>
  <a href="//www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fmatthieugouel.github.io%2fblog%2f2018-05-21-developpement-continu-a-la-maison-partie-2%2f" target="_blank" class="share-btn facebook">
    <i class="fa fa-facebook"></i>
    <p>Facebook</p>
    </a>
</li>


<li>
  <a href="//reddit.com/submit?url=https%3a%2f%2fmatthieugouel.github.io%2fblog%2f2018-05-21-developpement-continu-a-la-maison-partie-2%2f&amp;title=D%c3%a9veloppement%20continu%20%c3%a0%20la%20maison%20%28partie%202%29" target="_blank" class="share-btn reddit">
    <i class="fa fa-reddit-alien"></i>
    <p>Reddit</p>
  </a>
</li>


<li>
  <a href="//www.linkedin.com/shareArticle?url=https%3a%2f%2fmatthieugouel.github.io%2fblog%2f2018-05-21-developpement-continu-a-la-maison-partie-2%2f&amp;title=D%c3%a9veloppement%20continu%20%c3%a0%20la%20maison%20%28partie%202%29" target="_blank" class="share-btn linkedin">
      <i class="fa fa-linkedin"></i>
      <p>LinkedIn</p>
    </a>
</li>


<li>
  <a href="//www.stumbleupon.com/submit?url=https%3a%2f%2fmatthieugouel.github.io%2fblog%2f2018-05-21-developpement-continu-a-la-maison-partie-2%2f&amp;title=D%c3%a9veloppement%20continu%20%c3%a0%20la%20maison%20%28partie%202%29" target="_blank" class="share-btn stumbleupon">
    <i class="fa fa-stumbleupon"></i>
    <p>StumbleUpon</p>
  </a>
</li>


<li>
  <a href="//www.pinterest.com/pin/create/button/?url=https%3a%2f%2fmatthieugouel.github.io%2fblog%2f2018-05-21-developpement-continu-a-la-maison-partie-2%2f&amp;description=D%c3%a9veloppement%20continu%20%c3%a0%20la%20maison%20%28partie%202%29" target="_blank" class="share-btn pinterest">
    <i class="fa fa-pinterest-p"></i>
    <p>Pinterest</p>
  </a>
</li>


<li>
  <a href="mailto:?subject=Check out this post by &amp;body=https%3a%2f%2fmatthieugouel.github.io%2fblog%2f2018-05-21-developpement-continu-a-la-maison-partie-2%2f" target="_blank" class="share-btn email">
    <i class="fa fa-envelope"></i>
    <p>Email</p>
  </a>
</li>

        </ul>
    </section>
</section>

    
    <div id="main">
        
        
        <article class="post">
  <header>
    <div class="title">
        
            <h1><a href="/blog/2018-05-21-developpement-continu-a-la-maison-partie-2/">Développement continu à la maison (partie 2)</a></h1>
            
        
        
            <p>Installation du cluster Kubernetes</p>
        
    </div>
    <div class="meta">
        <time class="published"
            datetime='2018-05-21 00:00:00 &#43;0000 UTC'>
            21-05-2018</time>
        <span class="author"></span>
        
            <p>10 minutes</p>
        
    </div>
</header>


  
    <section id="social-share">
      <ul class="icons">
        


<li>
  <a href="//twitter.com/share?url=https%3a%2f%2fmatthieugouel.github.io%2fblog%2f2018-05-21-developpement-continu-a-la-maison-partie-2%2f&amp;text=D%c3%a9veloppement%20continu%20%c3%a0%20la%20maison%20%28partie%202%29&amp;via=matthieugouel" target="_blank" class="share-btn twitter">
    <i class="fa fa-twitter"></i>
    <p>Twitter</p>
    </a>
</li>


<li>
  <a href="//plus.google.com/share?url=https%3a%2f%2fmatthieugouel.github.io%2fblog%2f2018-05-21-developpement-continu-a-la-maison-partie-2%2f" target="_blank" class="share-btn google-plus">
    <i class="fa fa-google-plus"></i>
    <p>Google+</p>
  </a>
</li>


<li>
  <a href="//www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fmatthieugouel.github.io%2fblog%2f2018-05-21-developpement-continu-a-la-maison-partie-2%2f" target="_blank" class="share-btn facebook">
    <i class="fa fa-facebook"></i>
    <p>Facebook</p>
    </a>
</li>


<li>
  <a href="//reddit.com/submit?url=https%3a%2f%2fmatthieugouel.github.io%2fblog%2f2018-05-21-developpement-continu-a-la-maison-partie-2%2f&amp;title=D%c3%a9veloppement%20continu%20%c3%a0%20la%20maison%20%28partie%202%29" target="_blank" class="share-btn reddit">
    <i class="fa fa-reddit-alien"></i>
    <p>Reddit</p>
  </a>
</li>


<li>
  <a href="//www.linkedin.com/shareArticle?url=https%3a%2f%2fmatthieugouel.github.io%2fblog%2f2018-05-21-developpement-continu-a-la-maison-partie-2%2f&amp;title=D%c3%a9veloppement%20continu%20%c3%a0%20la%20maison%20%28partie%202%29" target="_blank" class="share-btn linkedin">
      <i class="fa fa-linkedin"></i>
      <p>LinkedIn</p>
    </a>
</li>


<li>
  <a href="//www.stumbleupon.com/submit?url=https%3a%2f%2fmatthieugouel.github.io%2fblog%2f2018-05-21-developpement-continu-a-la-maison-partie-2%2f&amp;title=D%c3%a9veloppement%20continu%20%c3%a0%20la%20maison%20%28partie%202%29" target="_blank" class="share-btn stumbleupon">
    <i class="fa fa-stumbleupon"></i>
    <p>StumbleUpon</p>
  </a>
</li>


<li>
  <a href="//www.pinterest.com/pin/create/button/?url=https%3a%2f%2fmatthieugouel.github.io%2fblog%2f2018-05-21-developpement-continu-a-la-maison-partie-2%2f&amp;description=D%c3%a9veloppement%20continu%20%c3%a0%20la%20maison%20%28partie%202%29" target="_blank" class="share-btn pinterest">
    <i class="fa fa-pinterest-p"></i>
    <p>Pinterest</p>
  </a>
</li>


<li>
  <a href="mailto:?subject=Check out this post by &amp;body=https%3a%2f%2fmatthieugouel.github.io%2fblog%2f2018-05-21-developpement-continu-a-la-maison-partie-2%2f" target="_blank" class="share-btn email">
    <i class="fa fa-envelope"></i>
    <p>Email</p>
  </a>
</li>

      </ul>
    </section>
  

  
    

    
        
        







  


        
        
        

        <a href="/blog/2018-05-21-developpement-continu-a-la-maison-partie-2/" class="image featured">
            <img src="/img/blog/devops.jpg" alt="">
        </a>
    


  <div id="content">
    

<p>Et voilà nous y sommes.  Après une longue introduction la fois précédente, aujourd’hui, on s’attaque enfin à la pratique ! Cet article a pour but d’installer notre cluster Kubernetes. C’est la première pierre à notre édifice (et non des moindres !) qui nous permettra ensuite d’installer tous nos services. Il s’agit donc de ne pas se rater !</p>

<!-- more -->

<p>Ça tombe bien parce que Kubernetes possède une documentation très complète. Je n’ai pas vraiment envie de copier-coller la documentation officielle dans cet article c’est pourquoi je vais abuser de liens vers celle-ci. De cette façon cet article sera à jour plus longtemps et évitera les redits.</p>

<p>Pour commencer détaillons les différents choix d’installation qui s’offrent à nous.  La documentation officielle nous fournit une <a href="https://kubernetes.io/docs/setup/pick-right-solution/#local-machine-solutions">page</a> nous permettant de choisir la bonne solution dans cet océan de possibilités. Je vous conseille de la parcourir, mais je vais résumer la situation à la lumière de notre ce que l’on souhaite réaliser. Notez bien que je ne vais pas parler de toutes les solutions possibles, juste celles qui me semblent intéressantes (et pas trop underground) pour notre usage.</p>

<h2 id="les-solutions-cloud">Les solutions « cloud »</h2>

<p>C’est la solution la plus simple, ici rien à faire ! Il y a des <a href="https://kubernetes.io/docs/setup/pick-right-solution/#hosted-solutions">tonnes</a> de cloud providers qui offrent des solutions Kubernetes tout cuit dans le bec. Je pense que cela peut être utile à notre niveau pour tester mais le réel avantage est à mon avis pour les entreprises qui n’ont pas forcément les moyens ou la stratégie de monter une architecture complexe pour leur business. Avec cette solution ils profitent de la mise à l’échelle, de la maintenabilité et des infrastructures de professionnels et ils payent à la carte ce dont ils ont besoin.</p>

<p>C’est plutôt cool mais dans notre cas ça ne nous intéresse pas vraiment. Eh oui le titre de cette série est tout de même <strong>Développement continu à la maison</strong> alors ce serait un peu tricher que d’utiliser un cloud provider vous ne trouvez pas ?</p>

<h2 id="les-solutions-en-localhost">Les solutions en localhost</h2>

<p>Ici c’est votre propre ordinateur qui fait office de cluster Kubernetes. C’est pratique car il n’y a pas besoin de dévouer une machine exprès pour le cluster. De plus, ces solutions sont souvent assez rapides à mettre en place.  C’est vraiment parfait pour faire des tests sans vouloir se prendre la tête. Évidemment l’inconvénient ce sont les performances.  Je vais tout de même faire un tour d’horizon de ces solutions pour ceux qui souhaiteraient suivre cette série dans un but davantage pédagogique que « productif ».  C’est aussi un bon moyen pour continuer à bosser sur sa machine quand on n&rsquo;est pas sur le réseau de production, par exemple dans le train ou dans l’avion.</p>

<h3 id="les-machine-virtuelles-toutes-faite">Les machine virtuelles toutes faite</h3>

<p>C’est <a href="https://kubernetes.io/docs/setup/pick-right-solution/#on-premises-vms">ici</a> que ça se passe. Le but est d’utiliser une image, souvent une base CoreOS, pour rapidement monter une ou plusieurs machines virtuelles. Comme vous pouvez le voir plein de solutions existent, mais je pense que le plus simple et le plus répandu à l’heure actuelle est d’utiliser Vagrant.
Vagrant est un logiciel open source qui aide à créer et manager des instances virtuelles. C’est très souvent utilisé pour monter rapidement et simplement des architectures de développement ou de test. Par exemple, on peut monter un cluster multi-node sur sa machine en suivant ce <a href="https://kubernetes.io/docs/getting-started-guides/coreos/">lien</a>.</p>

<h3 id="minikube">Minikube</h3>

<p>Minikube est un assistant permettant l’installation de Kubernetes en single-node (le master est aussi un worker) sur des environnements virtuels. En fait c’est encore plus facile que les VM toutes faite car il suffit de spécifier à Minikube l’hyperviseur utilisé (Virtualbox, KVM, VMware, …) et il se charge ensuite de faire tout le travail. C’est à mon sens la meilleure solution pour monter rapidement un environnement de test. Suivez ce <a href="https://kubernetes.io/docs/getting-started-guides/minikube/">guide</a> pour l’installation.</p>

<h2 id="les-solutions-sur-machine-s-dédié-s">Les solutions sur machine(s) dédié(s)</h2>

<p>On se rapproche d’un environnement de production. Même si les solutions en localhost sont pratiques pour commencer, nous on voudrait un vrai setup de développement continu à la maison comme les pros, non ? Là encore plusieurs solutions s’offrent à nous.</p>

<h3 id="kubeadm">Kubeadm</h3>

<p>Kubeadm est un assistant d’installation pour un cluster multi-node. C’est vraiment cool car cela permet d’installer notre cluster sans prise de tête tout ayant la possibilité de choisir les options les plus significatives (notamment la gestion du réseau).  Je pense que cette solution est parfaite pour quelqu’un qui souhaite monter un cluster en gardant un minimum de contrôle, sans forcément devoir y passer trop de temps. Personnellement c’est la solution que j’ai choisie pour mon cluster. Un autre avantage d’utiliser cet assistant est qu’il simplifie la gestion des mises à jour du cluster et permet de profiter assez simplement des dernières fonctionnalités (comprenez ici que, comme c’est plus simple de maintenir le cluster, on aura moins la flemme de faire les mises à jour). Suivez donc ce <a href="https://kubernetes.io/docs/setup/independent/create-cluster-kubeadm/">guide</a> si vous partez dans cette direction.</p>

<h3 id="bare-metal">Bare metal</h3>

<p>Dernière façon de faire présentée <a href="https://kubernetes.io/docs/setup/pick-right-solution/#bare-metal">ici</a>, celle du barbu. Et oui il n’y pas nécessairement besoin d’utiliser un assistant comme Minikube ou Kubeadm pour installer le cluster, on peut tout aussi bien le faire à la main sur une machine / VM muni de Fedora ou CoreOS. Cette solution est celle qui permettra d’être le plus précis dans ce qu’on veut faire mais ce sera aussi la plus complexe. À vous de voir si cette solution vous convient et si vous souhaitez passer du temps supplémentaire là dessus. Je pense sincèrement que c’est utile pour approfondir sa connaissance du produit, c’est un peu le bonus « pour finir le jeu à 100% ».</p>

<h2 id="astuces">Astuces</h2>

<p>Comme je vous l’ai dit je ne vais pas détailler l’installation du cluster pour chaque solution. En informatique, tout ce qu’on écrit à une date de péremption donc je préfère vous laisser des liens vers une documentation officielle qui sera maintenue à jour.
Mais bon, pour pas vous laisser comme ça je vous mets ci-dessous quelques astuces que j’ai employé quand j’ai installé mon cluster.</p>

<blockquote>
<p>Ces astuces ne sont pas obligatoires pour monter votre cluster. Ce sont juste certains choix que j’ai fait, mais je ne dis pas que ce sont les meilleurs. Je les mets là plutôt comme exemple / bookmark à prendre avec des pincettes et qui pourraient éventuellement vous aider à debugger en cas de soucis.</p>
</blockquote>

<h3 id="mes-choix-techniques">Mes choix techniques</h3>

<p>Personnellement j’ai utilisé 3 VM sous CentOS 7 installées via VirtualBox avec l&rsquo;ISO Minimal. N’ayant pas la joie d’avoir de vrais serveurs à la maison j’ai utilisé mon ancien laptop qui fait très bien l’affaire (comptez au moins 8Go de RAM tout de même).  Une VM est <strong>master</strong> et ne portera pas d’applications de production et les deux autres sont des <strong>workers</strong>. Ça me donne un peu de redondance sans avoir  besoin de trop de RAM (2Go / VM). Si vous avez 16Go sous la main (et un bon processeur au passage) je vous conseille de faire 4 VM de 3Go de RAM avec 1 master et 3 workers, avec ça vous serez plutôt bien. Enfin sachez qu’il est possible de faire de la redondance sur les masters, ce qui peut être intéressant également.</p>

<p>Pour la gestion du réseau j’ai utilisé <a href="https://github.com/coreos/flannel#flannel">Flannel</a>, mais vous pouvez choisir celui qui vous chante bien évidemment (un petit comparatif <a href="https://kubernetes.io/docs/concepts/cluster-administration/networking/">ici</a>). Flannel est très simple à mettre en place et fait le travail tout seul. Si vous souhaitez aller plus loin (et faire du full L3 par exemple) vous pouvez regarder du côté de <a href="https://www.projectcalico.org/">Calico</a>.</p>

<p>Sachez enfin que sur mon réseau j’ai un DHCP et un DNS. Ce dernier est assez obligatoire pour avoir vos propres nom en <code>*.home.local</code> par exemple. Il y a pleins de bon tutoriels sur comment monter un serveur DNS à la maison donc je n’aborderais pas ce sujet ici mais je ferais un article prochainement sur tous les services <em>enablers</em> que j’utilise à côté de mon cluster. Dans le même registre vous pouvez également monter un serveur NFS pour gérer les volumes persistants de vos applications mais ce n’est pas une nécessité pour avoir un cluster fonctionnel. Vous pourrez toujours le faire plus tard.</p>

<h3 id="bien-préparer-ses-machines">Bien préparer ses machines</h3>

<blockquote>
<p>Notez que les astuces de ce paragraphe sont à faire sur chaque noeud du cluster (en root).</p>
</blockquote>

<ul>
<li>Modifier l&rsquo;hostname de la machine si besoin pour par exemple coller avec son nom DNS.</li>
</ul>

<pre><code class="language-bash">hostnamectl --set-hostname worker
</code></pre>

<ul>
<li><p>Vérifier que les machines sont dans le même réseau (ou pas si vous savez ce que vous faite).</p></li>

<li><p>Les VM doivent avoir des MAC différentes. Vous pouvez le vérifier avec la commande  <code>ip addr</code>.</p></li>

<li><p>Les VM doivent avoir des product_uuid différents. Vous pouvez le vérifier avec cette commande :</p></li>
</ul>

<pre><code class="language-bash">cat /sys/class/dmi/id/product_uui
</code></pre>

<ul>
<li>Désactiver le swap:</li>
</ul>

<p>Voir l’état du swap :</p>

<pre><code class="language-bash">cat /proc/swaps
</code></pre>

<p>Supprimer le swap :</p>

<pre><code class="language-bash">swapoff -a
</code></pre>

<p>Et commenter la ligne de swap dans <code>/etc/fstab</code></p>

<ul>
<li>Désactiver SElinux</li>
</ul>

<p>Ce n’est pas recommandé mais cela peut vous éviter bien des soucis. Vous pouvez sauter cette étape si vous avez l’habitude d’utiliser SElinux ou si vous êtes obligé par mesure de sécurité.</p>

<p>Pour voir l&rsquo;état de SElinux :</p>

<pre><code class="language-bash">sestatus
</code></pre>

<p>Désactiver pour la session courante:</p>

<pre><code class="language-bash">setenforce 0
</code></pre>

<p>Désactiver définitivement (ne faites pas un copier-coller) :</p>

<pre><code class="language-bash">vi /etc/sysconfig/selinux + SELINUX=disabled
</code></pre>

<ul>
<li>Pour ne pas s’embêter avec le par-feux système et utiliser iptable à la place :</li>
</ul>

<pre><code class="language-bash">yum install iptables-services.x86_64 -y
systemctl stop firewalld.service
systemctl disable firewalld.service
systemctl mask firewalld.service
systemctl start iptables
systemctl enable iptables
systemctl unmask iptables
iptables -F
service iptables save
</code></pre>

<ul>
<li>Passer le trafic du bridge IPV4 dans la chaine iptables :</li>
</ul>

<pre><code class="language-bash">modprobe br_netfilter
sysctl net.bridge.bridge-nf-call-iptables=1
</code></pre>

<p>Et même pour être serein :</p>

<pre><code class="language-bash">cat &lt;&lt;EOF &gt; /etc/sysctl.d/k8s.conf
net.bridge.bridge-nf-call-ip6tables = 1
net.bridge.bridge-nf-call-iptables = 1
EOF
sysctl --system
</code></pre>

<ul>
<li>Installer ntpd</li>
</ul>

<pre><code class="language-bash">yum install ntp
systemctl enable ntpd
systemctl start ntpd
</code></pre>

<h3 id="installation-du-cluster-avec-kubeadm">Installation du cluster avec Kubeadm</h3>

<p>Ici je vous laisse suivre la documentation pour installer Kubeadm <a href="https://kubernetes.io/docs/setup/independent/install-kubeadm/">ici</a>.
Ensuite pour la création du cluster il suffit de suivre cette documentation <a href="https://kubernetes.io/docs/setup/independent/create-cluster-kubeadm/">là</a>.</p>

<p>Avec ça vous devriez vous en sortir sans problème ! :) N’hésitez pas à poser des questions en commentaire de cet article si vous êtes bloqué.</p>

<h3 id="tester-notre-cluster">Tester notre cluster</h3>

<p>On peut vérifier que notre cluster est fonctionnel avec une application de test fournie par Kubernetes :</p>

<pre><code class="language-bash">kubectl create namespace sock-shop
kubectl apply -n sock-shop -f &quot;https://github.com/microservices-demo/microservices-demo/blob/master/deploy/kubernetes/complete-demo.yaml?raw=true&quot;
</code></pre>

<p>L&rsquo;application est normalement installée. On peut récupérer le port exposé avec la commande suivante :</p>

<pre><code class="language-bash">kubectl -n sock-shop get svc front-end
</code></pre>

<pre><code>NAME CLUSTER-IP EXTERNAL-IP PORT(S) AGE
front-end 10.110.250.153 &lt;nodes&gt; 80:30001/TCP 59s
</code></pre>

<p>On voit ici que le port est le 30001 mais bien sûr chez vous il sera peut-être différent.</p>

<p>On attend que tout est bien en running (cela peut prendre quelques secondes à quelques minutes). Vous pouvez vérifier l’état du déploiement avec la commande :</p>

<pre><code class="language-bash">kubectl get pods -n sock-shop
</code></pre>

<p>Une fois que le pod est à l’état <em>running</em> on peut tester de s’y connecter avec un navigateur :</p>

<pre><code>http://&lt;master_ip&gt;:&lt;port&gt;
</code></pre>

<p>Si ça marche c&rsquo;est cool on peut supprimer l’application de test :</p>

<pre><code class="language-bash">kubectl delete namespace sock-shop
</code></pre>

<h2 id="conclusion">Conclusion</h2>

<p>Eh beh, je sais pas pour vous mais moi je suis tout de même assez fier d’avoir mon cluster Kubernetes multi-node qui tourne à la maison ! Peu importe le temps que ça vous a pris pour le monter, l’objectif est double : avoir une base pour nos développements futurs et apprendre quelque chose. Personnellement j’ai pris mon temps pour faire tout ça mais j’ai l’impression d’avoir une base assez solide sur laquelle je peux me reposer. Cela reste un MVP (Minimum Viable Product) mais nous allons étoffer tout cela au fur et à mesure.</p>

<p>Dans le prochain article on déploiera notre première vraie application sur notre cluster ! Peut-Être que vous l’avez déjà deviné mais ce sera <a href="https://traefik.io/">Træfik</a>, qui nous permettra de gérer l’interface entre notre cluster tout frais et le reste du monde (ou du moins le reste de notre réseau local).</p>

<p>Les articles de la série :</p>

<ul>
<li><a href="https://matthieugouel.github.io/blog/2018-05-14-developpement-continu-a-la-maison-partie-1/">Développement continu à la maison (partie 1)</a></li>
<li><a href="https://matthieugouel.github.io/blog/2018-05-21-developpement-continu-a-la-maison-partie-2/">Développement continu à la maison (partie 2)</a></li>
<li><a href="https://matthieugouel.github.io/blog/2018-06-04-developpement-continu-a-la-maison-partie-3/">Développement continu à la maison (partie 3)</a></li>
<li><a href="https://matthieugouel.github.io/blog/2018-06-27-developpement-continu-a-la-maison-partie-4/">Développement continu à la maison (partie 4)</a></li>
</ul>

  </div>

  <footer>
    <ul class="stats">
    
        

        
        
            <li>
                
                
                    

                    
                        Catégorie
                    
                
            </li>
        
    

    
    
        <li><a href='/categories/devops' lang="fr">DevOps</a></li>
    
</ul>

  </footer>

</article>

    <article class="post">
        <div id="disqus_thread"></div>
<script>
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "https-matthieugouel-github-io" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    </article>


<ul class="actions pagination">
    
        <li><a href="/blog/2018-05-14-developpement-continu-a-la-maison-partie-1/"
                class="button big previous">Développement continu à la maison (partie 1)</a></li>
    

    
        <li><a href="/blog/2018-05-28-gerer-nos-certificats-ssl/"
                class="button big next">Gérer nos certificats SSL</a></li>
    
</ul>


    </div>
    
<section id="sidebar">

  
  <section id="intro">
    
    
    
      <header>
        <h2>Random Logs</h2>
        <p>A collection of random thoughts</p>
      </header>
    
    
      <ul class="icons">
        
          
    <li><a href="https://matthieugouel.github.io/index.xml" type="application/rss+xml" target="_blank" title="RSS" class="fa fa-rss"></a></li>


        
        
  <li><a href="//github.com/matthieugouel" target="_blank" title="GitHub" class="fa fa-github"></a></li>







  <li><a href="//twitter.com/matthieugouel" target="_blank" title="Twitter" class="fa fa-twitter"></a></li>





















  <li><a href="//500px.com/matthieugouel" target="_blank" title="500px" class="fa fa-500px"></a></li>



  <li><a href="//linkedin.com/in/matthieu-gouel-04005295" target="_blank" title="LinkedIn" class="fa fa-linkedin"></a></li>



















































  <li><a href="mailto:matthieu.gouel@gmail.com" title="Email" class="fa fa-envelope"></a></li>


      </ul>
    
  </section>

  
  <section id="recent-posts">
    <div class="mini-posts">
      <header>
        <h3>Posts récents</h3>
      </header>
      <div class="posts-container">
        

        
          
        

        
          <article class="mini-post">
            <header>
              <h3>
                <a href="/blog/2018-11-22-oops-i-did-it-again/">Oops!... I Did It Again</a>
              </h3>
              
              <time class="published" datetime='2018-11-22 00:00:00 &#43;0000 UTC'>
              22-11-2018</time>
            </header>
            
    

    
        
        







  


        
        
        

        <a href="/blog/2018-11-22-oops-i-did-it-again/" class="image featured">
            <img src="/img/blog/dev.jpg" alt="">
        </a>
    


          </article>
        
          <article class="mini-post">
            <header>
              <h3>
                <a href="/blog/2018-07-24-presentation-de-gibica/">Présentation de Gibica</a>
              </h3>
              
              <time class="published" datetime='2018-07-24 00:00:00 &#43;0000 UTC'>
              24-07-2018</time>
            </header>
            
    

    
        
        







  


        
        
        

        <a href="/blog/2018-07-24-presentation-de-gibica/" class="image featured">
            <img src="/img/blog/dev.jpg" alt="">
        </a>
    


          </article>
        
          <article class="mini-post">
            <header>
              <h3>
                <a href="/blog/2018-06-27-developpement-continu-a-la-maison-partie-4/">Développement continu à la maison (partie 4)</a>
              </h3>
              
              <time class="published" datetime='2018-06-27 00:00:00 &#43;0000 UTC'>
              27-06-2018</time>
            </header>
            
    

    
        
        







  


        
        
        

        <a href="/blog/2018-06-27-developpement-continu-a-la-maison-partie-4/" class="image featured">
            <img src="/img/blog/devops.jpg" alt="">
        </a>
    


          </article>
        
          <article class="mini-post">
            <header>
              <h3>
                <a href="/blog/2018-06-05-developpement-continu-a-la-maison-partie-3/">Développement continu à la maison (partie 3)</a>
              </h3>
              
              <time class="published" datetime='2018-06-05 00:00:00 &#43;0000 UTC'>
              05-06-2018</time>
            </header>
            
    

    
        
        







  


        
        
        

        <a href="/blog/2018-06-05-developpement-continu-a-la-maison-partie-3/" class="image featured">
            <img src="/img/blog/devops.jpg" alt="">
        </a>
    


          </article>
        
          <article class="mini-post">
            <header>
              <h3>
                <a href="/blog/2018-05-28-gerer-nos-certificats-ssl/">Gérer nos certificats SSL</a>
              </h3>
              
              <time class="published" datetime='2018-05-28 00:00:00 &#43;0000 UTC'>
              28-05-2018</time>
            </header>
            
    

    
        
        







  


        
        
        

        <a href="/blog/2018-05-28-gerer-nos-certificats-ssl/" class="image featured">
            <img src="/img/blog/devops.jpg" alt="">
        </a>
    


          </article>
        
      </div>

      
        <a href=
          
            /blog/
          
        class="button">Voir plus</a>
      
    </div>
  </section>

  
  
  
  
  
    <section id="categories">
      <header>
        <h3>
          <a href="/fr/categories/">Catégories</a>
        </h3>
      </header>
        
          
        

        
        <p>
          <article>
            <header>
              
                <a href="/categories/devops/">DevOps</a>
                <span style="float:right;">4</span>
              
            </header>
          </article>
        </p>
        
        <p>
          <article>
            <header>
              
                <a href="/categories/projects/">Projects</a>
                <span style="float:right;">4</span>
              
            </header>
          </article>
        </p>
        
        <p>
          <article>
            <header>
              
                <a href="/categories/d%C3%A9veloppement/">Développement</a>
                <span style="float:right;">2</span>
              
            </header>
          </article>
        </p>
        
        <p>
          <article>
            <header>
              
                <a href="/categories/security/">Security</a>
                <span style="float:right;">1</span>
              
            </header>
          </article>
        </p>
        
    </section>
  
  


  
  
    <section id="mini-bio">
      <h3>à propos</h3>
      <p>Ce blog a pour but de partager mes pensées du moment ou ce que j'apprends au jour le jour. Ce n'est pas nécessairement quelque chose de très sérieux ou très élaboré, plutôt une succession de petites pensées aléatoires tirées de mon expérience personnelle.</p>
      <a href="/about" class="button">En savoir plus</a>
    </section>
  

  
  <section id="footer">
    
      <ul class="icons">
        
          
    <li><a href="https://matthieugouel.github.io/index.xml" type="application/rss+xml" target="_blank" title="RSS" class="fa fa-rss"></a></li>


        
        
  <li><a href="//github.com/matthieugouel" target="_blank" title="GitHub" class="fa fa-github"></a></li>







  <li><a href="//twitter.com/matthieugouel" target="_blank" title="Twitter" class="fa fa-twitter"></a></li>





















  <li><a href="//500px.com/matthieugouel" target="_blank" title="500px" class="fa fa-500px"></a></li>



  <li><a href="//linkedin.com/in/matthieu-gouel-04005295" target="_blank" title="LinkedIn" class="fa fa-linkedin"></a></li>



















































  <li><a href="mailto:matthieu.gouel@gmail.com" title="Email" class="fa fa-envelope"></a></li>


      </ul>
    
    <p class="copyright">
      
        &copy; 2018
        
          Random Logs
        
      .
      Powered by <a href="//gohugo.io" target="_blank">Hugo</a>
    </p>
  </section>
</section>

    </div>
    <a id="back-to-top" href="#" class="fa fa-arrow-up fa-border fa-2x"></a>
    

    
      
    

    
      
      
      
        <script src="//cdn.bootcss.com/highlight.js/9.11.0/highlight.min.js"></script>
        
        
        
        <script src="//cdn.bootcss.com/highlight.js/9.11.0/languages/r.min.js"></script>
        <script src="//cdn.bootcss.com/highlight.js/9.11.0/languages/yaml.min.js"></script>
        <script src="//cdn.bootcss.com/highlight.js/9.11.0/languages/css.min.js"></script>
        <script>hljs.configure({languages: []}); hljs.initHighlightingOnLoad();</script>
      
    
    
    
      <script src="https://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/skel/3.0.1/skel.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.1.25/jquery.fancybox.min.js"></script>
      <script src="/js/util.js"></script>
      <script src="/js/main.js"></script>
      <script src="/js/backToTop.js"></script>
    

    
      
        
      
    

    
    <script>hljs.initHighlightingOnLoad();</script>
  </body>
</html>

